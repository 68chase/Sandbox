<div class="row">
	<div class="span3">
		<h3 data-bind="text:currentAdminItem() == false?'Users':currentAdminItem().Username"></h3>
	</div>
</div>
<div class="row" data-bind="visible:currentAdminItem() == false">
	<div class="span4">
		<a data-bind="click:deleteSelected" href="">Delete Selected</a><br/><br/>
		<a href="{{root}}/admin">Admin Page</a>
	</div>
	<div class="adminDisplayList span4">
		<table class="table table-striped" style="border: 1px solid #ddd;">
			<tr>
				<th style="border:none; background:#FFF"><input type="checkbox" id="selectAllBox" data-bind="click:handleSelectAll" /></th>
				<th style="border:none; background:#FFF">Name</th>
			</tr>
			<tbody data-bind="foreach:adminDisplayList, style:{border:'none'}">
				<td><input type="checkbox" class="checkboxes" /></td>
				<td><a data-bind="text:$data.Username, attr:{href:'#'+$data.Username}" href=""></a></td>
			</tbody>
		</table>
	</div>
</div>
<div class="row" data-bind="visible:currentAdminItem() != false">
	<div class="span4">
		<a href="#">View full list of users</a>
	</div>
	<div class="adminDisplayList span4">
		<form> 
			
			<div style="height:50px;">
				<span>Edit user name:</span>
				<input type="text" style="float:right;" />			
			</div>
			<div>
				<span>Change password:</span>
				<input type="text"style="float:right;" /><br/>
			</div>
		</form>
		<button class="btn" style="margin: 0 auto;float:left;" data-bind="click:updateUser">Submit</button>
		<div>Under construction..</div>
	</div>
</div>
<script>

	
	$.post('{{root}}/data/get_users', function(o){
		o = JSON.parse(o);
		var newObject = [];
		
		for(var i = 0; i < o.length; i++){
			if(o[i]){
				newObject.push(o[i]);
			}
		}

		vwfPortalModel.adminDisplayList(newObject);
		handleHash("Username");
	}); 
	
	vwfPortalModel.deleteSelected = function(data){
		
		var tempUserArr = [], tempArr = [];
		for(var i = 0; i < $('input:checked').length; i++){
			tempUserArr.push(ko.dataFor($('input:checked')[i]));
			tempArr[i] = tempUserArr[i].Username ? tempUserArr[i].Username : tempUserArr[i];
		}
		
		//Make the request to the server to delete these users
		$.post('{{root}}/data/delete_users', JSON.stringify(tempArr), function(o){
			
			for(var i in tempUserArr){
				vwfPortalModel.adminDisplayList.remove(tempUserArr[i]);
			}
		});
		console.log("Delete users ", tempUserArr);
		$('input').prop("checked", false);
		vwfPortalModel.setSelectAll(false);
	}; 	
	
	vwfPortalModel.updateUser = function(e){
		
		//var sendObj = {id: };
		
		//Make the request to the server to delete these users
		$.post('{{root}}/data/update_user', JSON.stringify([213,213,213]), function(o){
			console.log("done");
		});
	}; 
	
	window.onhashchange = function(){handleHash("Username");};
	
	$(document).ready(function(){	
		ko.applyBindings(vwfPortalModel);
		getLoginInfo();
	});
</script>