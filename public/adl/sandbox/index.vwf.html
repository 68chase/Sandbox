<!DOCTYPE html>

<!-- Copyright 2012 United States Government, as represented by the Secretary of Defense, Under  -->
<!-- Secretary of Defense (Personnel & Readiness).                                               -->
<!--                                                                                             -->
<!-- Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file   -->
<!-- except in compliance with the License. You may obtain a copy of the License at              -->
<!--                                                                                             -->
<!--   http://www.apache.org/licenses/LICENSE-2.0                                                -->
<!--                                                                                             -->
<!-- Unless required by applicable law or agreed to in writing, software distributed under the   -->
<!-- License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,   -->
<!-- either express or implied. See the License for the specific language governing permissions  -->
<!-- and limitations under the License.                                                          -->

<html>
  <head>
	<style type="text/css">
	.playerlabel
	{
		cursor: pointer;
		font-size: 1.3em;
		font-weight: bold;
	}
	.playerlabel:hover
	{
		background-image: -webkit-linear-gradient(right, white 0%, #D9EEEF 100%)
	}
	.loadchoice
	{
		background-color: #DDD;
		border-radius: 3px;
		padding: 2px;
		box-shadow: 3px 3px 7px grey;
		margin-bottom: 5px;
	}
	.loadchoice:hover
	{
		background-color: #DDF;
		border-radius: 3px;
		padding: 2px;
		box-shadow: 3px 3px 7px grey;
		margin-bottom: 5px;
	}
	.BigTextureThumb
	{
		margin-left: auto;
		margin-right: auto;
		display: block;
		border: 1px solid black;
		width:128px;
		margin-bottom: 10px;
		cursor:pointer;
	}
	.textureChoice
	{
		width:50px;
		cursor:pointer;
	}
	.TransformEditorInput
	{
		width:25%;
		display:inline;
		border-radius: 5px;
		margin: 0px;
		padding: 0px;
		color:grey;
	}
	.EditorLabel
	{
		padding-bottom: 10px;
		padding-top: 10px;
	}
	.statusbar
	{
		position: fixed;
		width: 100%;
		height: 25px;
		z-index: 101;
		background-color: #414141
	}
	.usertable
	{
		width:100%;
		margin-bottom: 5px;
	}
	.headericon
	{
		vertical-align: middle;
		width: 30px;
		height: 30px;
	}
	.icon
	{
		width:25px;
		height:25px;
		vertical-align: middle;
		margin-top: 3px;
		border: 1px solid #505050;
		margin-left: 3px;
		border-radius: 6px;
		background: -webkit-linear-gradient(right, white 0%, rgb(217, 238, 239) 100%);
		padding: 1px;
		cursor:pointer;
	}
	.icon:hover
	{
		background: -webkit-linear-gradient(left, rgb(117, 138, 339) 0%, rgb(217, 238, 239) 100%);
		margin-top: 1px;
		margin-left: 1px;
		margin-right: 2px;
		margin-bottom: 2px;
	}
	.seperator
	{
		width:25px;
		height:25px;
		vertical-align: middle;
		margin-top: 3px;
		border-left: 1px solid #545454;
		margin-left: 10px;
		margin-right: 5px;
		padding: 1px;
		display:inline;
	}
	.usertable tr td
	{
	
		font: 8pt arial bold;
	}
	.usertable tr
	{
		box-shadow: 0px 0px 9px #AAA;
		display: block;
		border-radius: 5px;
		width: 100%;
		padding-bottom: 1px;
	}

	.statusbarElement{
		box-shadow: 0px 0px 13px gray inset;
		display: inline;
		height: 100%;
		padding: 5px;
		line-height: 25px;
		border-radius: 5px;
		color: gray;
		margin-left: 3px;
		margin-right: 3px;
		font-family: sans-serif;
		text-shadow: 1px 1px 3px black;
	}
	#sidepanel
	{
		z-index: 100;
		position: fixed;
		width: 320px;
		background-color: #414141;
	}
	#ScriptEditor
	{
		overflow: hidden;
		padding: 0px 0px 0px 0px;
		display: inline-table;
		position: fixed;
		
		z-index: 101;
		width: 100%;
		left: 0px;
	
	}
	#toolbar
	{
		z-index: 100;
		position: fixed;
		width: 100%;
		background-color: #414141;
		
	}
	.primeditorinputbox
	{
		display: inline;
		float: right;
		padding: 0;
		width: 50px;
		border-radius: 6px;
		background: transparent;
		text-align: center;
		border-width: 1px;
		color: grey;
	}
	@media only screen and (max-height:1200px)
	{
		#ScriptEditor
		{
			top: 683px;
			height: 405px;
		}
	}
	@media only screen and (max-height:1024px)
	{
		#ScriptEditor
		{
			top: 683px;
			height: 405px;
		}
	}
	@media only screen and (max-width:1280px)
	{
		
		.seperator
		{
			margin-left: 5px;
			margin-right: 0px;
			padding: 0px;
			
		}
		.icon
		{
			margin-left: 0px;
		}
		#sidepanel
		{
			width: 220px;
		}
	}
	@media only screen and (max-height:768px)
	{
		#ScriptEditor
		{
			top: 531px;
			height: 405px;
		}
	}
	@media only screen and (max-width:1024px)
	{
		#sidepanel
		{
			width: 250px;
		}
		.seperator
		{
			margin-left: 5px;
			margin-right: 0px;
			padding: 0px;
			
		}
		.icon
		{
			width:20px;
			height:20px;
		}
	}
	@media only screen and (max-width:800px)
	{
		#toolbar
		{
			
		}
		#ScriptEditor
		{
			top: 531px;
			height: 380px;
		}
		#sidepanel
		{
			width: 200px;
		}
		.seperator
		{
			margin-left: 0px;
			margin-right: 0px;
		}
		.primeditorinputbox
		{
			display: block;
			float: none;
			margin-top: 0px;
			margin-left: 0px;
		}
	}

	</style>
	
	<link rel="stylesheet" type="text/css" href="ddsmoothmenu.css" />
	<link rel="stylesheet" type="text/css" href="ddsmoothmenu-v.css" />

	<script type="text/javascript" src="ddsmoothmenu.js">

	/***********************************************
	* Smooth Navigational Menu- (c) Dynamic Drive DHTML code library (www.dynamicdrive.com)
	* This notice MUST stay intact for legal use
	* Visit Dynamic Drive at http://www.dynamicdrive.com/ for full source code
	***********************************************/

	</script>

	

	</head>
	<script type="text/javascript" src="_GLGERayTracer.js"></script>
	<script type="text/javascript" src="Editor.js"></script>
	<script type="text/javascript" src="MaterialEditor.js"></script>
	<script type="text/javascript" src="PrimitiveEditor.js"></script>
	<script type="text/javascript" src="Notifier.js"></script>
	<script type="text/javascript" src="UserManager.js"></script>
	<script type="text/javascript" src="DataManager.js"></script>
	<script type="text/javascript" src="ScriptEditor.js"></script>
	<script type="text/javascript" src="_3DRIntegration.js"></script>
	<script type="text/javascript" src="InventoryManager.js"></script>
	<script type="text/javascript" src="Help.js"></script>
	<script type="text/javascript" src="jquery.qtip-1.0.0-rc3.min.js"></script>
	<script type="text/javascript" src="http://crypto-js.googlecode.com/svn/tags/3.0.2/build/rollups/sha256.js"></script>
	
	<script type="text/javascript">
	
	$(document).ready(
	function(){
				/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
				 * Licensed under the MIT License (LICENSE.txt).
				 *
				 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
				 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
				 * Thanks to: Seamus Leahy for adding deltaX and deltaY
				 *
				 * Version: 3.0.6
				 * 
				 * Requires: 1.2.2+
				 */

				(function($) {

				var types = ['DOMMouseScroll', 'mousewheel'];

				if ($.event.fixHooks) {
					for ( var i=types.length; i; ) {
						$.event.fixHooks[ types[--i] ] = $.event.mouseHooks;
					}
				}

				$.event.special.mousewheel = {
					setup: function() {
						if ( this.addEventListener ) {
							for ( var i=types.length; i; ) {
								this.addEventListener( types[--i], handler, false );
							}
						} else {
							this.onmousewheel = handler;
						}
					},
					
					teardown: function() {
						if ( this.removeEventListener ) {
							for ( var i=types.length; i; ) {
								this.removeEventListener( types[--i], handler, false );
							}
						} else {
							this.onmousewheel = null;
						}
					}
				};

				$.fn.extend({
					mousewheel: function(fn) {
						return fn ? this.bind("mousewheel", fn) : this.trigger("mousewheel");
					},
					
					unmousewheel: function(fn) {
						return this.unbind("mousewheel", fn);
					}
				});


				function handler(event) {
					var orgEvent = event || window.event, args = [].slice.call( arguments, 1 ), delta = 0, returnValue = true, deltaX = 0, deltaY = 0;
					event = $.event.fix(orgEvent);
					event.type = "mousewheel";
					
					// Old school scrollwheel delta
					if ( orgEvent.wheelDelta ) { delta = orgEvent.wheelDelta/120; }
					if ( orgEvent.detail     ) { delta = -orgEvent.detail/3; }
					
					// New school multidimensional scroll (touchpads) deltas
					deltaY = delta;
					
					// Gecko
					if ( orgEvent.axis !== undefined && orgEvent.axis === orgEvent.HORIZONTAL_AXIS ) {
						deltaY = 0;
						deltaX = -1*delta;
					}
					
					// Webkit
					if ( orgEvent.wheelDeltaY !== undefined ) { deltaY = orgEvent.wheelDeltaY/120; }
					if ( orgEvent.wheelDeltaX !== undefined ) { deltaX = -1*orgEvent.wheelDeltaX/120; }
					
					// Add event and delta to the front of the arguments
					args.unshift(event, delta, deltaX, deltaY);
					
					return ($.event.dispatch || $.event.handle).apply(this, args);
				}

				})(jQuery);
				
	
		
		document._UserManager = _UserManager;
		//hook up the editor object
		$('#vwf-root').mousedown(function(e){_Editor.mousedown(e)});
		
		$('#vwf-root').mouseup(function(e){_Editor.mouseup(e)});
		$('#vwf-root').mouseleave(function(e){_Editor.mouseup(e)});
		$('#vwf-root').mousemove(function(e){_Editor.mousemove(e)});
		$('#vwf-root').keydown(function(e){
			
			_Editor.keydown(e)
			if(e.keyCode == 32 && e.shiftKey)
				focusSelected();
		});
		$('#vwf-root').css('overflow','hidden');
		$(document.body).css('font-size','10px');
		$('#tabs').css('z-index','101');
		$('#AvatarChoice').buttonset();
		
		$('#vwf-root').attr('tabindex','0');
		vwf.logger.level = 6;
		$('#ChatWindow').dialog({ position:['left','top'],width:300,height:400,title: "Chat Window",buttons: { "Close": function() { $(this).dialog("close"); },"Send": function() { SendChatMessage(); } },autoOpen:false});

		 
		if(document.Players)
		{
			for(var i = 0; i< document.Players.length; i++)
			{
				_UserManager.PlayerCreated(document.Players[i]);
			}
		}
		ddsmoothmenu.init({
			mainmenuid: "smoothmenu1", //menu DIV id
			orientation: 'h', //Horizontal or vertical menu: Set to "h" or "v"
			classname: 'ddsmoothmenu', //class added to menu's outer DIV
			//customtheme: ["#1c5a80", "#18374a"],
			contentsource: "markup" //"markup" or ["container_id", "path_to_menu_file"]
		});
		
		//make the menu items disappear when you click one
		//$(".ddsmoothmenu").find('li').click(function(){$(".ddsmoothmenu").find('li').trigger('mouseleave');});
		
		$('#MenuLogOut').attr('disabled','true');
		$('#MenuLogIn').click(function(e){
			
			if($('#MenuLogIn').attr('disabled') == 'disabled')
				return;
				
			_UserManager.showLogin();
		});
		$('#MenuLogOut').click(function(e){
			
			if($('#MenuLogOut').attr('disabled') == 'disabled')
				return;
			_UserManager.SceneDestroy();	
			
		});
		$('#MenuSelectPick').click(function(e){
			_Editor.SetSelectMode('Pick');
		});
		$('#MenuSelectNone').click(function(e){
			_Editor.SelectObject(null);
			_Editor.SetSelectMode('None');
		});
		$('#MenuMove').click(function(e){
			_Editor.SetGizmoMode(_Editor.Move);
			$('#MenuRotateicon').css('background',"");
			$('#MenuScaleicon').css('background',"");
			$('#MenuMoveicon').css('background',"#9999FF");
		});
		$('#MenuRotate').click(function(e){
			_Editor.SetGizmoMode(_Editor.Rotate);
			$('#MenuRotateicon').css('background',"#9999FF");
			$('#MenuScaleicon').css('background',"");
			$('#MenuMoveicon').css('background',"");
		});
		$('#MenuScale').click(function(e){
			_Editor.SetGizmoMode(_Editor.Scale);
			$('#MenuRotateicon').css('background',"");
			$('#MenuScaleicon').css('background',"#9999FF");
			$('#MenuMoveicon').css('background',"");
		});
		$('#MenuMulti').click(function(e){
			_Editor.SetGizmoMode(_Editor.Multi);
		});
		$('#MenuSaveCopy').click(function(e){
			_InventoryManager.Take();
		});
		
		
		$('#MenuShare').click(function(e){
			$('#ShareWithDialog').dialog('open');
		});
		
		$('#MenuSetParent').click(function(e){
			_Editor.SetParent();
		});
		$('#MenuRemoveParent').click(function(e){
			_Editor.RemoveParent();
		});
		
		$('#MenuSelectParent').click(function(e){
			_Editor.SelectParent();
		});
		
		$('#MenuLocal').click(function(e){
			_Editor.SetCoordSystem(_Editor.LocalCoords);
			if(_Editor.GetMoveGizmo())
				_Editor.updateGizmoOrientation(true);
		});
		$('#MenuWorld').click(function(e){
			_Editor.SetCoordSystem(_Editor.WorldCoords);
			if(_Editor.GetMoveGizmo())
				_Editor.updateGizmoOrientation(true);
		});
		$('#MenuDelete').click(function(e){
			_Editor.DeleteSelection();
		});
		$('#MenuChat').click(function(e){
			$('#ChatWindow').dialog('open');
		});
		$('#MenuUsers').click(function(e){
			
			$('#Players').prependTo($('#Players').parent());
			$('#Players').show('blind',function(){
			
			});
			
			showSidePanel();
		});
		$('#MenuModels').click(function(e){
			_ModelLibrary.show();
		});
		$('#MenuSnapLarge').click(function(e){
			_Editor.SetSnaps(.5,15 * 0.0174532925,5);
		});
		$('#MenuSnapMedium').click(function(e){
			_Editor.SetSnaps(.25,5 * 0.0174532925,2);
		});
		$('#MenuSnapSmall').click(function(e){
			_Editor.SetSnaps(.1,1 * 0.0174532925,.5);
		});
		$('#MenuSnapOff').click(function(e){
			_Editor.SetSnaps(.005,.01 * 0.0174532925,.001);
		});
	    $('#MenuMaterialEditor').click(function(e){
			_MaterialEditor.show();
		});
		$('#MenuScriptEditor').click(function(e){
			_ScriptEditor.show();
		});
		$('#MenuInventory').click(function(e){
			_InventoryManager.show();
		});
		$('#MenuObjectProperties').click(function(e){
			_PrimitiveEditor.show();
		});
		$('#MenuCopy').click(function(e){
			_Editor.Copy();
		});
		$('#MenuPaste').click(function(e){
			_Editor.Paste();
		});
		$('#MenuDuplicate').click(function(e){
			_Editor.Duplicate();
		});
		$('#MenuCreateTaper').click(function(e){
			_Editor.CreateModifier('taper',document.PlayerNumber);
		});
		$('#MenuCreateBend').click(function(e){
			_Editor.CreateModifier('bend',document.PlayerNumber);
		});
		$('#MenuCreateTwist').click(function(e){
			_Editor.CreateModifier('twist',document.PlayerNumber);
		});
		$('#MenuCreateUVMap').click(function(e){
			_Editor.CreateModifier('uvmap',document.PlayerNumber);
		});
		$('#MenuCreateNoise').click(function(e){
			_Editor.CreateModifier('noise',document.PlayerNumber);
		});
		$('#MenuCreateOffset').click(function(e){
			_Editor.CreateModifier('offset',document.PlayerNumber);
		});
		$('#MenuCreateStretch').click(function(e){
			_Editor.CreateModifier('stretch',document.PlayerNumber);
		});
		$('#MenuCreateTangents').click(function(e){
			_Editor.CreateModifier('tangents',document.PlayerNumber);
		});
		
		$('#MenuSave').click(function(e){
			_DataManager.save();
		});
		$('#MenuSaveAs').click(function(e){
			_DataManager.saveAs();
		});
		$('#MenuLoad').click(function(e){
			_DataManager.load();
		});
		$('#MenuChangeInstance').click(function(e){
			_DataManager.chooseInstance();
		});
		
		$('#ChatInput').keypress(function(e){
			e.stopPropagation();
			ChatKeypress(e);
		});
		$('#ChatInput').keydown(function(e){
			e.stopPropagation();
			
		});
		
		function focusSelected()
		{
			if(_Editor.GetSelectedVWFNode())
			 {
				if(_Editor.GetSelectedVWFNode())
				 {
					var gizpos = [_Editor.GetMoveGizmo().getLocX(),_Editor.GetMoveGizmo().getLocY(),_Editor.GetMoveGizmo().getLocZ()];
					var box = _Editor.findviewnode(_Editor.GetSelectedVWFNode().id).GetBoundingBox();
					var dist = GLGE.distanceVec3(box.max,box.min);
					vwf.models[0].model.nodes['index-vwf'].orbitPoint(gizpos);
					vwf.models[0].model.nodes['index-vwf'].zoom = dist * 2;
					vwf.models[0].model.nodes['index-vwf'].updateCamera();
				 }
			 }
		}
		$('#MenuFocusSelected').click(function(e){
			focusSelected();
		});
		$('#MenuCameraOrbit').click(function(e){
			
				clearCameraModeIcons();
				$('#MenuCameraOrbiticon').css('background','#9999FF');
				var campos = [_Editor.findscene().camera.getLocX(),_Editor.findscene().camera.getLocY(),_Editor.findscene().camera.getLocZ()];
				var ray = _Editor.GetCameraCenterRay();
				var dxy = _Editor.intersectLinePlane(ray,campos,[0,0,0],_Editor.WorldZ);
				var newintersectxy = GLGE.addVec3(campos,GLGE.scaleVec3(ray,dxy));
				vwf.models[0].model.nodes['index-vwf'].orbitPoint(newintersectxy);
				vwf.models[0].model.nodes['index-vwf'].updateCamera();
			 
		});
		
		
		$('#MenuCameraNavigate').click(function(e){
			clearCameraModeIcons();
			$('#MenuCameraNavigateicon').css('background','#9999FF');
			vwf.models[0].model.nodes['index-vwf'].setCameraMode('Orbit');
			vwf.models[0].model.nodes['index-vwf'].setCameraMode('Navigate');
			
		});
		$('#MenuCameraFree').click(function(e){
			clearCameraModeIcons();
			$('#MenuCameraFreeicon').css('background','#9999FF');
			vwf.models[0].model.nodes['index-vwf'].setCameraMode('Orbit');
			vwf.models[0].model.nodes['index-vwf'].setCameraMode('Free');
		});
		
		$('#MenuCameraFirstPerson').click(function(e){
			
			if(_UserManager.GetCurrentUserName())
			{
				clearCameraModeIcons();
				$('#MenuCameraFirstPersonicon').css('background','#9999FF');
				vwf.models[0].model.nodes['index-vwf'].followObject(vwf.models[0].model.nodes['-object-Object-player-' + _UserManager.GetCurrentUserName()]);
				vwf.models[0].model.nodes['index-vwf'].setCameraMode('FirstPerson');
			}else
			{
				_Notifier.alert('First person mode is not available when you are not logged in.');
			}
		});
		
		$('#MenuCreateBox').click(function(e){
			
			
			var campos = [_Editor.findscene().camera.getLocX(),_Editor.findscene().camera.getLocY(),_Editor.findscene().camera.getLocZ()];
			var ray = _Editor.GetCameraCenterRay();
			var dxy = _Editor.intersectLinePlane(ray,campos,[0,0,0],_Editor.WorldZ);
			var newintersectxy = GLGE.addVec3(campos,GLGE.scaleVec3(ray,dxy));
			_Editor.CreatePrim('box',newintersectxy,[1,1,1],'checker.jpg',document.PlayerNumber,'');
			
		});
		$('#MenuCreateSphere').click(function(e){
			
			
			var campos = [_Editor.findscene().camera.getLocX(),_Editor.findscene().camera.getLocY(),_Editor.findscene().camera.getLocZ()];
			var ray = _Editor.GetCameraCenterRay();
			var dxy = _Editor.intersectLinePlane(ray,campos,[0,0,0],_Editor.WorldZ);
			var newintersectxy = GLGE.addVec3(campos,GLGE.scaleVec3(ray,dxy));
			_Editor.CreatePrim('sphere',newintersectxy,[.5,1,1],'checker.jpg',document.PlayerNumber,'');
			
		});
		$('#MenuCreatePlane').click(function(e){
			
			var campos = [_Editor.findscene().camera.getLocX(),_Editor.findscene().camera.getLocY(),_Editor.findscene().camera.getLocZ()];
			var ray = _Editor.GetCameraCenterRay();
			var dxy = _Editor.intersectLinePlane(ray,campos,[0,0,0],_Editor.WorldZ);
			var newintersectxy = GLGE.addVec3(campos,GLGE.scaleVec3(ray,dxy*.99));
			_Editor.CreatePrim('plane',newintersectxy,[1,1,5],'checker.jpg',document.PlayerNumber,'');
			
		});
		$('#MenuCreateCylinder').click(function(e){
			
			var campos = [_Editor.findscene().camera.getLocX(),_Editor.findscene().camera.getLocY(),_Editor.findscene().camera.getLocZ()];
			var ray = _Editor.GetCameraCenterRay();
			var dxy = _Editor.intersectLinePlane(ray,campos,[0,0,0],_Editor.WorldZ);
			var newintersectxy = GLGE.addVec3(campos,GLGE.scaleVec3(ray,dxy*.99));
			_Editor.CreatePrim('cylinder',newintersectxy,[1,.5,.5],'checker.jpg',document.PlayerNumber,'');
			
		});
		$('#MenuCreateCone').click(function(e){
			
			var campos = [_Editor.findscene().camera.getLocX(),_Editor.findscene().camera.getLocY(),_Editor.findscene().camera.getLocZ()];
			var ray = _Editor.GetCameraCenterRay();
			var dxy = _Editor.intersectLinePlane(ray,campos,[0,0,0],_Editor.WorldZ);
			var newintersectxy = GLGE.addVec3(campos,GLGE.scaleVec3(ray,dxy*.99));
			_Editor.CreatePrim('cone',newintersectxy,[.500,1,.5],'checker.jpg',document.PlayerNumber,'');
			
		});
		$('#MenuCreatePyramid').click(function(e){
			
			var campos = [_Editor.findscene().camera.getLocX(),_Editor.findscene().camera.getLocY(),_Editor.findscene().camera.getLocZ()];
			var ray = _Editor.GetCameraCenterRay();
			var dxy = _Editor.intersectLinePlane(ray,campos,[0,0,0],_Editor.WorldZ);
			var newintersectxy = GLGE.addVec3(campos,GLGE.scaleVec3(ray,dxy*.99));
			_Editor.CreatePrim('pyramid',newintersectxy,[1,1,1],'checker.jpg',document.PlayerNumber,'');
			
		});
		 
		
        if(_DataManager.getClientCount() == 1)
		{
			_DataManager.loadFromServer();
		}	
	
		window.setTimeout(function(){_DataManager.saveTimer();},60000);		
		window.onbeforeunload = function(){
			if(_DataManager.getClientCount() == 1)
			{
				_DataManager.saveToServer();
				return "Are you sure you want to leave this VWF world?";
			}		
		};
		
		$(window).resize(function(){
		$('#smoothmenu1').css('top','0px');
		$('#smoothmenu1').css('left','0px');
		$('#toolbar').css('top',$('#smoothmenu1').height());
		//$('#toolbar').css('height','35px');
		$('#toolbar').css('left','0px');
		$('#statusbar').css('left','0px');
		if($('#sidepanel').offset().left + 5 < window.innerWidth)
			$('#index-vwf').css('width',window.innerWidth - $('#sidepanel').width() + 'px');
		else
			$('#index-vwf').css('width',window.innerWidth + 'px');
		
		$('#ScriptEditor').css('top',$(window).height() - $('#ScriptEditor').height()-$('#statusbar').height());
		//$('#ScriptEditor').css('height',	$(window).height() - $('#ScriptEditor').offset().top - $('#statusbar').height() + 'px');
		
		$('#ScriptEditor').css('width',$('#index-vwf').width());	
		if($('#ScriptEditor').attr('maximized'))
		{
			$('#ScriptEditor').css('top',$('#toolbar').offset().top + $('#toolbar').height() +'px');
			$('#ScriptEditor').css('height',$(window).height() - $('#toolbar').height()- $('#smoothmenu1').height()- $('#statusbar').height()+'px');
		}
		else
		{
			
			//$('#ScriptEditor').css('top',$('#ScriptEditor').attr('originaltop')+'px');
			//$('#ScriptEditor').css('height',$(window).height() - $('#ScriptEditor').offset().top- $('#statusbar').height()+'px');
			
		}
		_ScriptEditor.resize();
		$('#index-vwf').css('height',window.innerHeight + 'px' - $('#ScriptEditor').offset().top);
		
		$('#index-vwf').css('top',$('#toolbar').offset().top+$('#toolbar').height());
		$('#index-vwf').css('position','absolute');
		$('#vwf-root').css('overflow','visible');
		$('#vwf-root').css('left','0px');
		$('#vwf-root').css('top','0px');
		var scripteditorheight = $('#ScriptEditor').offset().top;
		if(scripteditorheight != 0)
		   scripteditorheight = $(window).height() - scripteditorheight;
		$('#index-vwf').css('height',window.innerHeight - $('#smoothmenu1').height() - $('#statusbar').height() - $('#toolbar').height() - (scripteditorheight-25) + 'px');
		
		$('#sidepanel').css('left',$('#index-vwf').width() + $('#index-vwf').offset().left);
		//$('#sidepanel').css('width',320);
		$('#sidepanel').css('top',$('#toolbar').offset().top+$('#toolbar').height());
		$('#sidepanel').css('height',$(window).height());
		$('#statusbar').css('top',($(window).height() - 25) + 'px');
		
		
		
		_Editor.findscene().camera.setAspect($('#index-vwf').width()/$('#index-vwf').height());
		});
		$(window).resize();
		
		window.setTimeout(function(){$(window).resize();hideSidePanel();},500);
		
		$( "#sidepanel" ).sortable({distance: 15});
        $( "#sidepanel" ).disableSelection();
		$(document.body).disableSelection();
		$(document.body).css('overflow','hidden');
		
		createIcon('images/icons/logout.png','MenuLogIn','Log In');
		createIcon('images/icons/login.png','MenuLogOut','Log Out');
		createSeperator();
		createIcon('images/icons/Move.png','MenuMove','Move Tool');
		createIcon('images/icons/rotate.png','MenuRotate','Rotate Tool');
		createIcon('images/icons/scale.png','MenuScale','Scale Tool');
		createSeperator();
		createIcon('images/icons/worldspace.png','MenuWorld','Use World Coordinates');
		createIcon('images/icons/localspace.png','MenuLocal','Use Local Coordinates');
		createSeperator();
		createIcon('images/icons/pick.png','MenuSelectPick','Select by clicking');
		createIcon('images/icons/selectnone.png','MenuSelectNone','Select None');
		createSeperator();
		createIcon('images/icons/copy.png','MenuCopy','Copy');
		createIcon('images/icons/paste.png','MenuPaste','Paste');
		createIcon('images/icons/duplicate.png','MenuDuplicate','Duplicate');
		createIcon('images/icons/save.png','MenuSaveCopy','Save to Inventory');
		createIcon('images/icons/delete.png','MenuDelete','Delete');
		createSeperator();
		createIcon('images/icons/link.png','MenuSetParent','Link');
		createIcon('images/icons/unlink.png','MenuRemoveParent','Unlink');
		createIcon('images/icons/up.png','MenuSelectParent','Select Parent');
		createSeperator();
		createIcon('images/icons/camera.png','MenuCameraOrbit','Orbit Camera');
		createIcon('images/icons/firstperson.png','MenuCameraFirstPerson','First Person Camera');
		createIcon('images/icons/navigate.png','MenuCameraNavigate','Navigation Camera');
		createIcon('images/icons/free.png','MenuCameraFree','Free Camera');
		createIcon('images/icons/target.png','MenuFocusSelected','Focus to selected object');
		createSeperator();
		createIcon('images/icons/sphere.png','MenuCreateSphere','Create Sphere');
		createIcon('images/icons/cube.png','MenuCreateBox','Create Box');
		createIcon('images/icons/Cylinder.png','MenuCreateCylinder','Create Cylinder');
		createIcon('images/icons/cone.png','MenuCreateCone','Create Cone');
		createIcon('images/icons/pyramid.png','MenuCreatePyramid','Create Pyramid');
		createIcon('images/icons/plane.png','MenuCreatePlane','Create Plane');
		createSeperator();
		
	
  
		createIcon('images/icons/users.png','MenuUsers','Show Users Window');
		createIcon('images/icons/chat.png','MenuChat','Show Chat Window');
		createIcon('images/icons/material.png','MenuMaterialEditor','Show Material Editor Window');
		createIcon('images/icons/script.png','MenuScriptEditor','Show Script Editor Window');
		createIcon('images/icons/properties.png','MenuObjectProperties','Show Object Properties Window');
		createIcon('images/icons/models.png','MenuModels','Show Model Library Window');
		createIcon('images/icons/inventory.png','MenuInventory','Show Inventory Window');
		
		createPanelShowHide();
		$(document).disableSelection();
		$('#MenuCameraOrbiticon').css('background','#9999FF');
		$('#MenuMoveicon').css('background',"#9999FF");
		$('#MenuWorldicon').css('background',"#9999FF");
		$('#MenuLogOuticon').css('background',"#555555");
	});
	var sizeTimeoutHandle;
	function sizeWindowTimer()
	{
		_Editor.findscene().camera.setAspect($('#index-vwf').width()/$('#index-vwf').height());
		_ScriptEditor.resize();
		
	}
	function createIcon(src,menuitemname,tooltip)
	{ 
		
		var iconname = menuitemname+"icon";
		var mn = menuitemname;
		$('#toolbar').append('<img src="'+src+'" id="'+iconname+'" class="icon" />');
		$('#'+iconname).click(function()
		{
			
			$('#'+mn).click();
			$(this).css('background: -webkit-linear-gradient(left, rgb(317, 138, 139) 0%, rgb(217, 238, 239) 100%);');
			$(".ddsmoothmenu").find('li').trigger('mouseleave');
		}
		);
		
		$('#'+iconname).qtip({
			content: tooltip,
			show: { delay: 1000 }
			});
	}
	function clearCameraModeIcons()
	{
		$('#MenuCameraOrbiticon').css('background','');
		$('#MenuCameraFirstPersonicon').css('background','');
		$('#MenuCameraNavigateicon').css('background','');
		$('#MenuCameraFreeicon').css('background','');
	}
	function createPanelShowHide(src)
	{ 
		
		var iconname = "togglesidepanelicon";
		$('#toolbar').append('<img src="images/icons/left.png" id="'+iconname+'" class="icon" />');
		$('#togglesidepanelicon').css('float','right');
		$('#'+iconname).click(function()
		{
			if($('#sidepanel').offset().left < $(window).width())
				hideSidePanel();
			else
				showSidePanel();
		}
		);
	}
	function createSeperator()
	{
		
		
		$('#toolbar').append('<div class="seperator" />');
		
	}

	function hideSidePanel()
	{
		window.clearInterval(window.sizeTimeoutHandle);
		window.sizeTimeoutHandle = window.setInterval(sizeWindowTimer,33);
		$('#togglesidepanelicon').attr('src','images/icons/left.png');
		$('#sidepanel').animate({'left':$(window).width()});
		$('#ScriptEditor').animate({'width':$(window).width()});
		$('#index-vwf').animate({'width':$(window).width()},function()
		{
			window.clearInterval(window.sizeTimeoutHandle);
			sizeWindowTimer();
			window.sizeTimeoutHandle = null;
			
		});
	}
	function showSidePanel()
	{
		window.clearInterval(window.sizeTimeoutHandle);
		window.sizeTimeoutHandle = window.setInterval(sizeWindowTimer,33);
		$('#togglesidepanelicon').attr('src','images/icons/right.png');
		$('#sidepanel').animate({'left':$(window).width()-$('#sidepanel').width()});
		$('#ScriptEditor').animate({'width':$(window).width()-$('#sidepanel').width()});
		$('#index-vwf').animate({'width':$(window).width()-$('#sidepanel').width()},function()
		{
			window.clearInterval(window.sizeTimeoutHandle);
			window.sizeTimeoutHandle = null;
			
		});
	}
	function SendChatMessage()
	{
	
		if(document.PlayerNumber == null)
		{
			_Notifier.notify('You must log in to participate');
			return;
		}
		var parms = new Array();
		parms.push(JSON.stringify({sender:document.PlayerNumber,text:$('#ChatInput').val()}));
		vwf_view.kernel.callMethod('index-vwf','receiveChat',parms);
		$('#ChatInput').val('');
	}
	function SendPM(text,receiver)
	{
		
		if(document.PlayerNumber == null)
		{
			_Notifier.notify('You must log in to participate');
			return;
		}
		var parms = new Array();
		parms.push(JSON.stringify({sender:document.PlayerNumber,text:text,receiver:receiver}));
		vwf_view.kernel.callMethod('index-vwf','PM',parms);
		
	}
	function ToSafeID(value)
	{
		return value.replace(/[^A-Za-z0-9]/g, "");
	}
	function setupPmWindow(e)
	{
		
		var s = e;
		e = ToSafeID(e);
		if($('#PM'+e).length ==1)
		{
			$('#PM'+e).dialog("open");
		}else
		{
			$(document.body).prepend("<div id='"+'PM'+e+"' style='width: 100%;margin:0px;padding:0px;overflow:hidden'/>");
			$('#PM'+e).dialog({title:"Chat with " + s,autoOpen:true});
			$('#PM'+e).attr('receiver',s);
			
			
			var setup = '<div class="text ui-widget-content ui-corner-all" style="background-image: -webkit-linear-gradient(top, white 0%, #D9EEEF 100%);width: 99%;top: 0%; height:80%;padding:0px;margin:0px;position: absolute;overflow-y:auto">'+
			'<table id="ChatLog'+e+'" style="width:100%;background-color: transparent;">'+
			'</table>'+
			'</div>'+
			'<input type="text" name="ChatInput" id="ChatInput'+e+'" class="text ui-widget-content ui-corner-all" style="width: 99%;top: 82%;position: absolute;padding: 0px;font-size: 1.2em;"/>';		
			$('#PM'+e).append(setup);
			$('#ChatInput'+e).attr('receiver',s);
			$('#ChatInput'+e).keypress(function(e){
				
				var text = $(this).val();
				var rec = $(this).attr('receiver');
				
				 var key;
				 if(window.event)
					  key = window.event.keyCode;     //IE
				 else
					  key = e.which;     //firefox
				 if(key == 13)
				{
				
					SendPM(text,rec);
					$(this).val('');
				}
				//e.preventDefault();
				e.stopImmediatePropagation();
				
			});
			$('#ChatInput'+e).keydown(function(e){
				e.stopImmediatePropagation();
				
				
			});
			$('#ChatInput'+e).keyup(function(e){
				e.stopImmediatePropagation();
				
			});
			$('#ChatInput'+e).change(function(e){
				e.stopImmediatePropagation();
				
			});
			
			
		}
	}
	function PMReceived(e)
	{
		
		e = JSON.parse(e);
		
		if(e.sender != document.PlayerNumber && e.receiver != document.PlayerNumber) 
			return;
		
		if(e.sender != document.PlayerNumber && e.receiver == document.PlayerNumber) 
			setupPmWindow(e.sender);
		var color = 'darkred';
		if(e.sender == document.PlayerNumber)
			color = 'darkblue';
		if(e.sender != document.PlayerNumber)	
			$('#ChatLog'+ToSafeID(e.sender)).append('<tr><td style="vertical-align: top;width: 25%;min-width: 25%;margin-right: 1em;color:'+color+';display: table-cell;">'+e.sender+'</td><td style="color:'+color+';width: 75%;max-width: 75%;">'+e.text+'</td></tr>');
		else	
			$('#ChatLog'+ToSafeID(e.receiver)).append('<tr><td style="vertical-align: top;width: 25%;min-width: 25%;margin-right: 1em;color:'+color+';display: table-cell;">'+e.sender+'</td><td style="color:'+color+';width: 75%;max-width: 75%;">'+e.text+'</td></tr>');
	}
	function ChatMessageReceived(e)
	{
		var message = JSON.parse(e);
		var color = 'darkred';
		if(message.sender == document.PlayerNumber)
			color = 'darkblue';
		$('#ChatLog').append('<tr><td style="vertical-align: top;width: 25%;min-width: 25%;margin-right: 1em;color:'+color+';display: table-cell;">'+message.sender+'</td><td style="color:'+color+';width: 75%;max-width: 75%;">'+message.text+'</td></tr>');
	
	}

	function PlayerDeleted(e)
	{
		$("#"+e+"label").remove();
	}
	function GUID()
    {
        var S4 = function ()
        {
            return Math.floor(
                    Math.random() * 0x10000 /* 65536 */
                ).toString(16);
        };

        return (
                S4() + S4() + "-" +
                S4() + "-" +
                S4() + "-" +
                S4() + "-" +
                S4() + S4() + S4()
            );
    }

	
	
	</script>	
	<script language="JavaScript">
	
	function disableEnterKey(e)
	{
		 var key;
		 if(window.event)
			  key = window.event.keyCode;     //IE
		 else
			  key = e.which;     //firefox
		 if(key == 13)
			  return false;
		 else
			  return true;
	}
	function ChatKeypress(e)
	{
		 var key;
		 
		 if(window.event)
			  key = window.event.keyCode;     //IE
		 else
			  key = e.which;     //firefox
		 if(key == 13)
		 {
			SendChatMessage();
			return false;
		 }
		 
		 return true;
		 
		 
	}
	function PMKeypress(event,to)
	{
		
		 var key;
		 if(window.event)
			  key = window.event.keyCode;     //IE
		 else
			  key = e.which;     //firefox
		 if(key == 13)
		 {
			SendPMMessage('test',to);
			return false;
		 }
		 
		 return true;
		 
		 
	}
	</script>


  </head>
  <body style="font-size:10px; background-color: #515151">
    
<div id="sidepanel" style=""> </div>
<div id="toolbar" style=""> </div>		
<div id="smoothmenu1" class="ddsmoothmenu" style="z-index: 1000;position: fixed;width: 100%;border-bottom: 1px solid #555555;">
<ul>
<li><a href="#">File</a>
<ul>
	  <li><a href="#" id="MenuLogIn">Log In</a></li>	  
	  <li><a href="#" id="MenuLogOut">Log Out</a></li>
	  <li><a href="#" id="MenuChangeInstance">Change Instance ...</a></li>
</ul>
</li>

<li><a href="#">Edit</a>
  <ul>
	  	  
	  <li><a href="#" id="MenuCopy">Copy</a></li>
	  <li><a href="#" id="MenuPaste">Paste</a></li>
	  <li><a href="#" id="MenuDuplicate">Duplicate</a></li>
	  <li><a href="#" id="MenuDelete">Delete</a></li>
	  <li><a href="#" id="MenuSaveCopy">Save Copy</a></li>
	  <li><a href="#" id="MenuShare">Share</a></li>
	  <li><a href="#">Select</a>
		<ul>
			<li><a href="#" id="MenuSelectName">Select By Name</a></li>
			<li><a href="#" id="MenuSelectPick">Pick</a></li>
			<li><a href="#" id="MenuSelectNone">Select None</a></li>
		</ul>	
	  </li>
	  <li><a href="#">Transform</a>
		  <ul>
			  <li><a href="#" id="MenuMove">Move</a></li>
			  <li><a href="#" id="MenuRotate">Rotate</a></li>
			  <li><a href="#" id="MenuScale">Scale</a></li>
			  <li><a href="#" id="MenuMulti">Multi</a></li>
			  <li><a href="#" ></a></li>
			  <li><a href="#" id="MenuLocal">Local Coords</a></li>
			  <li><a href="#" id="MenuWorld">World Coords</a></li>
			  <li><a href="#" ></a></li>
			  <li><a href="#">Snaps</a>
			  <ul>
				  <li><a href="#" id="MenuSnapLarge">Large</a></li>
				  <li><a href="#" id="MenuSnapMedium">Medium</a></li>
				  <li><a href="#" id="MenuSnapSmall">Small</a></li>
				  <li><a href="#" id="MenuSnapOff">Off</a></li>
				  
			  </ul>
		  </li>
		  </ul>
	  </li>
	  
</ul>
</li>
<li><a href="#">Camera</a>
  <ul>
  <li><a href="#" id="MenuFocusSelected" >Focus Selected</a></li>
  <li><a href="#" id="MenuCameraOrbit">Orbit</a></li>
  <li><a href="#" id="MenuCameraFree">Free</a></li>
  <li><a href="#" id="MenuCameraFirstPerson">First Person</a></li>
  <li><a href="#" id="MenuCameraNavigate">Navigate</a></li>
  </ul>
</li>
<li><a href="#">Hierarchy</a>
  <ul>
  <li><a href="#" id="MenuSetParent" >Link</a></li>
  <li><a href="#" id="MenuRemoveParent" >Unlink</a></li>
  <li><a href="#" id="MenuSelectParent" >Select Parent</a></li>
  </ul>
</li>

<li><a href="#">Create</a>
  <ul>
    <li><a href="#">Primitives</a>
		<ul>
		  <li><a href="#" id="MenuCreateSphere">Sphere</a></li>
		  <li><a href="#" id="MenuCreateBox">Box</a></li>
		  <li><a href="#" id="MenuCreatePlane">Plane</a></li>
		  <li><a href="#" id="MenuCreateCylinder">Cylinder</a></li>
		  <li><a href="#" id="MenuCreateCone">Cone</a></li>
		  <li><a href="#" id="MenuCreatePyramid">Pyramid</a></li>
		</ul>
	</li>
	<li><a href="#">Modifiers</a>
		<ul>
		  <li><a href="#" id="MenuCreateBend">Bend</a></li>
		  <li><a href="#" id="MenuCreateTwist">Twist</a></li>
		  <li><a href="#" id="MenuCreateTaper">Taper</a></li>
		  <li><a href="#" id="MenuCreateUVMap">UVMap</a></li>
		  <li><a href="#" id="MenuCreateNoise">Noise</a></li>
		  <li><a href="#" id="MenuCreateOffset">Offset</a></li>
		  <li><a href="#" id="MenuCreateStretch">Stretch</a></li>
		  <li><a href="#" id="MenuCreateTangents">Build Tangents</a></li>
		</ul>
	</li>
  </ul>
</li>
<li><a href="#">Windows</a>
  <ul>
  <li><a href="#" id="MenuChat">Chat</a></li>
  <li><a href="#" id="MenuUsers">Users</a></li>
  <li><a href="#" id="MenuMaterialEditor">Material Editor</a></li>
  <li><a href="#" id="MenuScriptEditor">Script Editor</a></li>
  <li><a href="#" id="MenuObjectProperties">Object Properties</a></li>
  <li><a href="#" id="MenuModels">Models</a></li>
  <li><a href="#" id="MenuInventory">Inventory</a></li>
  </ul>
</li>
<li><a href="#">Help</a>
  <ul>
  <li><a href="#" id="MenuHelpAbout">About</a></li>
  <li><a href="#" id="MenuHelpBrowse">Browse All Topics...</a></li>
  </ul>
</li>
</ul>
<br style="clear: left" />
</div>


	<div id="ChatWindow" style="width: 100%;margin:0px;padding:0px">
		
		<div class="text ui-widget-content ui-corner-all" style="background-image: -webkit-linear-gradient(top, white 0%, #D9EEEF 100%);width: 99%;top: 0%; height:90%;padding:0px;margin:0px;position: absolute;overflow-y:auto">
			<table id="ChatLog" style='width:100%;background-color: transparent;'>
			
			</table>
		</div>
	    
		<input type="text" name="ChatInput" id="ChatInput" class="text ui-widget-content ui-corner-all" style="width: 99%;top: 92%;position: absolute;padding: 0px;font-size: 1.2em;"/>		
	</div>

  </body>
</html>
